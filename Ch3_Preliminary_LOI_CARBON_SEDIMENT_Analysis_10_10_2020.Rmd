---
title: "Updated Analysis of Carbon DATA"
author: "Jenn_McHenry"
date: "3/02/2021"
output: html_document
---

## R Markdown

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(lubridate)
library(plyr)
library(raster)
library(sp)
library(ggplot2)
```

#Loading in the seagrass survey data 
```{r}

#Seagrass Data
seagrass_surveys=read.csv("data/Carbon/Seagrass_Species_Cover_QAQC_with_Environmental_Factors.csv")
head(seagrass_surveys)
summary(seagrass_surveys)
names(seagrass_surveys)

seagrass_surveys=seagrass_surveys%>%
  mutate(Seagrass_Spp=(Thalassia.testudinum+Syringodium.filiforme+Halodule.wrightii+Halophila.decipens+Halophila.engelmanni+Ruppia.maritima),Algal_Spp=(Acanthophora.spicifera+Caulerpa.verticillata+Halimeda.incrassata+Penicillus.capitatus+Sargassum+Udotea.flabellum))


#Seagrass Clippings
seagrass_clippings=read.csv("data/Carbon/Seagrass_Clippings_Data_version_11_23_2020.csv")

seagrass_clippings=seagrass_clippings%>%
  mutate(Dry_Weight_Corrected=Dry.Weight..g.- Boat.Weight..g.)

names(seagrass_clippings)

seagrass_clippings=seagrass_clippings[c(2:7,17,16)]

colnames(seagrass_clippings)<-c("Site","Quadrat","Species","Common.Name","Species_Type","Biomass_Type","Sample_gDW","Notes")

seagrass_clippings=seagrass_clippings%>%
  dplyr::filter(Species_Type=="SAV" | Species_Type=="Algae")%>%
  filter(Biomass_Type=="AGB" | Biomass_Type=="ABG")%>%
  filter(Sample_gDW>0)
summary(seagrass_clippings)
names(seagrass_clippings)

seagrass_clippings_Site=seagrass_clippings%>%
  dplyr::group_by(Site,Species)%>%
  dplyr::summarize(Biomass_gDW=mean(Sample_gDW))%>%
  dplyr::filter(Species!="epiphytic_algae")%>%
  tidyr::spread(key = Species,value = Biomass_gDW,fill = 0)%>%
  mutate(Macro_Algae_Biomass_gDW=Acanthophora_spicifera+filamentous_red_algae+Halimeda_incrassata+Penicillus_sp +  branched_red_algae + Udotea_flabellum_)%>%
  mutate(Seagrass_Biomass_gDW= Halodule_wrightii + Halophila_decipiens + Halophila_engelmanni + Ruppia_maritima + Syringodium_filiforme + Thalassia_testudinum) 

names(seagrass_clippings_Site)

colnames(seagrass_clippings_Site)<-c("Site","Acanthophora_spicifera_gDW", "Branched_red_algae","Filamentous_algae_gDW", "Halimeda_incrassata_gDW","Halodule_wrightii_gDW",
                                     "Halophila_decipiens_gDW", 
                                     "Halophila_engelmanni_gDW",
                                     "Penicillus_sp_gDW",
                                     "Ruppia_maritima_gDW",
                                     "Syringodium_filiforme_gDW",
                                     "Thalassia_testudinum_gDW",  
                                     "Udotea_flabellum_gDW","Unidentified_Alga_gDW", "Macro_Algae_Biomass_gDW","Seagrass_Biomass_gDW" )

levels(as.factor(seagrass_clippings$Quadrat))


Compation_Ratio=read.csv("data/Carbon/Core_Length_Data_version_10_07_2020.csv")
names(Compation_Ratio)
colnames(Compation_Ratio)<-c("Date","Region","Site","Dive.Name","Original_Quadrat","Insertion_Depth_cm","Core_Length_cm","Compaction_Ratio","Alt_Number","Quadrat","Notes")
dim(Compation_Ratio)
Compation_Ratio=unique(Compation_Ratio)
dim(Compation_Ratio)

Compation_Ratio=Compation_Ratio[c(3,10,6:9)]

Compation_Ratio=Compation_Ratio%>%
  mutate(Core_Length_Corrected_cm=Core_Length_cm*Compaction_Ratio)

levels(Compation_Ratio$Site)


#LOI Data
LOI=read.csv("data/Carbon/LOI_Data_version_03_18_2021.csv")
# head(LOI)
names(LOI)

LOI=LOI[c(2:8,11:12,23:35)]
names(LOI)
# head(LOI)

colnames(LOI)=c("Site","Quadrat","Bagged_Slice_Number","Slice_Number","Analysis","Rhizome_Removed","Slice_Height_cm","Shell_gDW","Rhizome_gDW","Frac_OLOI","Frac_ILOI","OLOI","ILOI","Sample_Weight_gDW","Sediment_Weight_gDW","Sample_Density_g_per_ml","Sediment_Density_g_per_ml","Organic_Content_gDW","Inorganic_Content_gDW","Organic_Content_Density_g_per_ml","Inorganic_Content_Density_g_per_ml","Percent_Carbon")
levels(LOI$Site)
levels(as.factor(LOI$Quadrat))


LOI=join(Compation_Ratio[c(1:3,5,7)],LOI,by=c("Site","Quadrat"))
levels(Compation_Ratio$Site)
levels(as.factor(Compation_Ratio$Quadrat))

levels(LOI$Site)
levels(as.factor(LOI$Quadrat))


## GOTTA CHECK THE CALCULATIONS REALLY CLOSELY. I THINK WE NEED TO MULTIPLY PERCENTAGES BY GRAMS BEFORE DIVDING BY THE CORRECTED VOLUME.
# RIGHT NOW I'M CALCULATING DENSITIES AND THEN MULTIPLYING THE PERCENTAGES

LOI_QAQC=LOI%>%
  dplyr::mutate(Slice_Height_Corrected_cm=(Slice_Height_cm*Compaction_Ratio),Slice_Area_cm2=pi*(2.54^2),Slice_Volume_cm3=Slice_Area_cm2*Slice_Height_Corrected_cm)%>%
 dplyr::mutate(Sample_Density_g_per_ml=Sample_Weight_gDW/Slice_Volume_cm3,
         Sediment_Density_g_per_ml=Sediment_Weight_gDW/Slice_Volume_cm3,
         Organic_Content_Density_g_per_ml=Frac_OLOI * Sediment_Density_g_per_ml,
         Inorganic_Content_Density_g_per_ml=Frac_ILOI * Sediment_Density_g_per_ml)%>%
 dplyr::mutate(Frac_Shell=(Shell_gDW)/Sample_Weight_gDW,
         Shell_Density_g_per_ml=Frac_Shell*Sample_Density_g_per_ml, 
         Frac_Rhizome=Rhizome_gDW/Sample_Weight_gDW,
         Rhizome_Density_g_per_ml=Frac_Rhizome*Sample_Density_g_per_ml,
         Rhizome_Density_g_per_ml=ifelse(Rhizome_Removed=="Y",Rhizome_Density_g_per_ml,NA))%>%
  dplyr::select(1:10,26:28,11:24,30,32,25)%>%
    dplyr::mutate(Factor=ifelse(Site=="SJBA" | Site=="SJBB" | Site=="SJBC" | Site=="SMARA" | Site=="SMARB" | Site=="SMARC" | Site=="STCHA" |Site=="STCHB" |Site=="STCHC"  ,"Control","Seagrass"),
         Percent_Carbon=(0.4839*OLOI)-0.3648,
         Percent_Carbon=ifelse(Percent_Carbon<0,0.001,Percent_Carbon))%>%
  dplyr::mutate(Sediment_Depth_cm=Slice_Height_Corrected_cm*Slice_Number,
         Sediment_Depth_Group=ifelse(Sediment_Depth_cm<=10,"0-10cm",ifelse(Sediment_Depth_cm>10 & Sediment_Depth_cm<=20,"10-20cm",ifelse(Sediment_Depth_cm>20 & Sediment_Depth_cm<=30,"20-30cm","below30cm"))))%>%
  dplyr::select(1:13,18:19,22:23,26:33)

write.csv(LOI_QAQC,file="data_output/LOI_Data_version_QAQC_03_18_2020.csv")

#Grain size analysis 
Grainsize=read.csv("data/Carbon/Grainsize_Data_version_03_18_2021.csv")
Grainsize=as.data.frame(Grainsize)
# head(Grainsize)
summary(Grainsize)
names(Grainsize)

Grainsize=Grainsize%>%
  mutate(Fraction.of.Pebbles=ifelse(Qualtiy.Control.Chedck>1.01,NA,Fraction.of.Pebbles),
         Fraction.of.Gravel=ifelse(Qualtiy.Control.Chedck>1.01,NA,Fraction.of.Gravel),
         Fraction.of.Coarse.Sand=ifelse(Qualtiy.Control.Chedck>1.01,NA,Fraction.of.Coarse.Sand),
         Fraction.of.Medium.Sand=ifelse(Qualtiy.Control.Chedck>1.01,NA,Fraction.of.Medium.Sand),
         Fraction.of.Fine.Sand=ifelse(Qualtiy.Control.Chedck>1.01,NA,Fraction.of.Fine.Sand),
         Fraction.of.Silt.Mud=ifelse(Qualtiy.Control.Chedck>1.01,NA,Fraction.of.Silt.Mud))

Grainsize_QAQC=Grainsize[c(2:11,18:23)]
names(Grainsize_QAQC)
levels(Grainsize_QAQC$Site)
levels(LOI_QAQC$Site)


colnames(Grainsize_QAQC)=c("Site","Quadrat","Bagged_Slice_Number","Slice_Number","Analysis","Rhyzome_Removed","Slice_Height_cm","Sample_Weight_gDW","Rhizome_gDW","Sediment_Weight_gDW","Frac_Pebbles","Frac_Gravel","Frac_Coarse_Sand","Frac_Medium_Sand","Frac_Fine_Sand","Frac_Silt")


Grainsize_QAQC=join(Compation_Ratio[c(1:2,5,7)],Grainsize_QAQC,by=c("Site","Quadrat"))
levels(Grainsize_QAQC$Site)


Grainsize_QAQC=Grainsize_QAQC%>%
  # mutate(Rhizome_Removed=ifelse(Slice_Number==4,"Y","N"))%>%
  dplyr::mutate(Slice_Height_Corrected_cm=(Slice_Height_cm*Compaction_Ratio),Slice_Area_cm2=pi*(2.54^2),Slice_Volume_cm3=Slice_Area_cm2*Slice_Height_Corrected_cm)%>%
  mutate(Sample_Density_g_per_ml=Sample_Weight_gDW/Slice_Volume_cm3,
         Sediment_Density_g_per_ml=Sediment_Weight_gDW/Slice_Volume_cm3,
         Frac_Rhizome=Rhizome_gDW/Sample_Weight_gDW,
         Rhizome_Density_g_per_ml=Frac_Rhizome*Sample_Density_g_per_ml)%>%
    dplyr::mutate(Factor=ifelse(Site=="SJBA" | Site=="SJBB" | Site=="SJBC" | Site=="SMARA" | Site=="SMARB" | Site=="SMARC" | Site=="STCHA" |Site=="STCHB" |Site=="STCHC" ,"Control","Seagrass"))%>%
  mutate(Percent_Shell=Frac_Pebbles*100,Percent_Gravel=Frac_Gravel*100,Percent_Coarse=Frac_Coarse_Sand*100,Percent_Medium=Frac_Medium_Sand*100,Percent_Fine=Frac_Fine_Sand*100,Percent_Silt=Frac_Silt*100)%>%
  dplyr::select(1:8,19:32)

names(Grainsize_QAQC)

# Grainsize_QAQC=Grainsize_QAQC%>%
#   mutate(Percent_Sands=Percent_Coarse+Percent_Medium+Percent_Fine)

write.csv(Grainsize_QAQC,file="data_output/Grainsize_Data_version_QAQC_03_18_2021.csv")


```


#Basic Plots
```{r}
names(LOI_QAQC)

ggplot(Compation_Ratio,aes(x=Compaction_Ratio))+geom_histogram()+xlab("Compaction Ratio") +ylab("Number of Cores")

ggplot(Compation_Ratio,aes(x=Core_Length_Corrected_cm))+geom_histogram()+xlab("Uncompressed Core Length (cm)") +ylab("Number of Cores")

ggplot(LOI_QAQC,aes(x=(Sediment_Depth_cm)))+geom_histogram(binwidth = 1)+xlab("Sediment Depth (cm)") +ylab("Number of Core Slices")

#Sediments
Grainsize_QAQC_long=Grainsize_QAQC%>%
  dplyr::select(1:2,12:13,15:22)%>%
  gather(key="Grainsize","Percent",7:12)


#grainsizes
ggplot(Grainsize_QAQC_long,aes(x=as.integer(Percent),fill=Factor))+geom_histogram(position = "dodge") + xlab("Percent Grainsize per Slice") + ylab("Frequency") + facet_wrap(~Grainsize)

```



#Combinging analytical datasets 
```{r}
names(LOI_QAQC)

LOI_QAQC_By_Site_Slice=LOI_QAQC%>%
  dplyr::group_by(Site,Factor,Quadrat,Bagged_Slice_Number,Slice_Number,Slice_Height_Corrected_cm,Sediment_Depth_cm,Sediment_Depth_Group)%>%
  dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE),Organic_Content_Density_g_per_ml=mean(Organic_Content_Density_g_per_ml,na.rm=TRUE),Inorganic_Content_Density_g_per_ml=mean(Inorganic_Content_Density_g_per_ml,na.rm=TRUE),Percent_Carbon=mean(Percent_Carbon,na.rm=TRUE),Rhizome_Density_g_per_ml=mean(Rhizome_Density_g_per_ml,na.rm=TRUE),Shell_Density_g_per_ml=mean(Shell_Density_g_per_ml,na.rm=TRUE),Sediment_Density_g_per_ml=mean(Sediment_Density_g_per_ml,na.rm=TRUE),Sample_Density_g_per_ml=mean(Sample_Density_g_per_ml,na.rm=TRUE))%>%
  ungroup()%>%
  filter(is.na(OLOI)==FALSE)%>%
  dplyr::mutate(Organic_Carbon_Density_g_per_ml=(Percent_Carbon/100) * Sediment_Density_g_per_ml,
         Inorganic_Carbon_Density_g_per_ml=(Inorganic_Content_Density_g_per_ml* 0.12),
         Total_Carbon_Density_g_per_ml=Organic_Carbon_Density_g_per_ml+Inorganic_Carbon_Density_g_per_ml)



LOI_QAQC_By_Site_Slice%>%
  dplyr::group_by(Sediment_Depth_Group,Factor)%>%
  dplyr::summarise(mean=mean(OLOI),n=n())

ggplot(LOI_QAQC_By_Site_Slice,aes(x=(Sediment_Depth_cm)))+geom_histogram(binwidth = 1)+xlab("Sediment Depth (cm)") +ylab("Frequency")

#Rhizome 
ggplot(LOI_QAQC_By_Site_Slice,aes(y=Rhizome_Density_g_per_ml,fill=Factor),na.rm=TRUE)+geom_boxplot() +ylab("Rhizome g/ml") + xlab("") +facet_wrap(~Sediment_Depth_Group,nrow=1)+ ggtitle("Rhizome Content (g/ml) by Sediment Depth Bin (%)")


#OM %
ggplot(LOI_QAQC_By_Site_Slice,aes(y=as.integer(OLOI),fill=Factor),na.rm=TRUE)+geom_boxplot() +ylab("Sedimentary Organics Per Slice") + xlab("") +facet_wrap(~Sediment_Depth_Group,nrow=1)+ ggtitle("Organic Matter by Sediment Depth Bin (%)")


#OM Density
ggplot(LOI_QAQC_By_Site_Slice,aes(y=(Organic_Content_Density_g_per_ml),fill=Factor),na.rm=TRUE)+geom_boxplot() + ylab("Organic Density of Slice") + ylab("") +facet_wrap(~Sediment_Depth_Group,nrow=1)+ ggtitle("Organic Density by Sediment Depth Bin (g/ ml)")

#IOM %
ggplot(LOI_QAQC_By_Site_Slice,aes(y=as.integer(ILOI),fill=Factor),na.rm=TRUE)+geom_boxplot() + ylab("Sedimentary Carbonates Per Slice") + ylab("") +facet_wrap(~Sediment_Depth_Group,nrow=1)+ggtitle("Carbonates by Sediment Depth Bin (%)")

#Inorganic Density
ggplot(LOI_QAQC_By_Site_Slice,aes(y=(Inorganic_Content_Density_g_per_ml),fill=Factor),na.rm=TRUE)+geom_boxplot() + ylab("Carbonate Density of Slice") + xlab("") +facet_wrap(~Sediment_Depth_Group,nrow=1)+ ggtitle("Carbonate Density by Sediment Depth Bin (g/ ml)")

#% Organic C
ggplot(LOI_QAQC_By_Site_Slice,aes(y=(Percent_Carbon),fill=Factor),na.rm=TRUE)+geom_boxplot() + ylab("Organic Carbon Per Slice") + ylab("") +facet_wrap(~Sediment_Depth_Group,nrow=1)+ggtitle("Organic Carbon by Sediment Depth Bin (%)")

#Organic Carbon Density
ggplot(LOI_QAQC_By_Site_Slice,aes(y=(Organic_Carbon_Density_g_per_ml),fill=Factor),na.rm=TRUE)+geom_boxplot() + xlab("Organic Carbon Density of Slice") + ylab("Number of Core Slices") +facet_wrap(~Sediment_Depth_Group,nrow=1)+ ggtitle("Organic Carbon Density by Sediment Depth Bin (g/ml)")

#Total Carbon Density
ggplot(LOI_QAQC_By_Site_Slice,aes(y=(Total_Carbon_Density_g_per_ml),fill=Factor),na.rm=TRUE)+geom_boxplot() + xlab("Total Caron Density of Slice") + ylab("Number of Core Slices") +facet_wrap(~Sediment_Depth_Group,nrow=1)+ ggtitle("Total Carbon Density by Sediment Depth Bin (g/ ml)")


## BY DEPTH
# Rhizome (g/ml) 
LOI_QAQC_By_Site_Slice%>%
  dplyr::mutate(Sediment_Depth_cm=as.factor(as.integer(Sediment_Depth_cm)))%>%
  dplyr::group_by(Factor,Site,Quadrat,Sediment_Depth_cm)%>%
  dplyr::summarize(mean=mean(Rhizome_Density_g_per_ml,na.rm=TRUE),cover=mean())%>%
  mutate(Sediment_Depth_cm=as.integer(Sediment_Depth_cm))%>%
              ggplot(aes(y=(mean),x=-Sediment_Depth_cm,color=Factor,fill=Factor))+geom_point() + geom_smooth(method="gam",) + ylab("Rhizome Density (g/cm3) of Slice") + xlab("Sediment Depth (cm)") + ggtitle("Rhizome Content by Sediment Depth ")+coord_flip()

#testing for relationship with slice depth 
rhiz_depth_lm=lm(Rhizome_Density_g_per_ml ~ Factor*Sediment_Depth_cm + Factor, data=LOI_QAQC_By_Site_Slice)
summary(rhiz_depth_lm)


# Shell  (g/ml) 
LOI_QAQC_By_Site_Slice%>%
  dplyr::mutate(Sediment_Depth_cm=as.factor(as.integer(Sediment_Depth_cm)))%>%
  dplyr::group_by(Factor,Site,Quadrat,Sediment_Depth_cm)%>%
  dplyr::summarize(mean=mean(Shell_Density_g_per_ml,na.rm=TRUE))%>%
  mutate(Sediment_Depth_cm=as.integer(Sediment_Depth_cm))%>%
              ggplot(aes(y=(mean),x=-Sediment_Depth_cm,color=Factor,fill=Factor))+geom_point() + geom_smooth(method="gam",) + ylab("Shell Density (g/cm3) of Slice") + xlab("Sediment Depth (cm)") + ggtitle("Shell Content by Sediment Depth ")+coord_flip()

#testing for relationship with slice depth 
rhiz_depth_lm=lm(Rhizome_Density_g_per_ml ~ Factor*Sediment_Depth_cm + Factor, data=LOI_QAQC_By_Site_Slice)
summary(rhiz_depth_lm)
# Percent OLOI
LOI_QAQC_By_Site_Slice%>%
  dplyr::mutate(Sediment_Depth_cm=as.factor(as.integer(Sediment_Depth_cm)))%>%
  dplyr::group_by(Factor,Site,Quadrat,Sediment_Depth_cm)%>%
  dplyr::summarize(mean=mean(OLOI,na.rm=TRUE))%>%
  mutate(Sediment_Depth_cm=as.integer(Sediment_Depth_cm))%>%
              ggplot(aes(y=(mean),x=-Sediment_Depth_cm,color=Factor,fill=Factor))+geom_point() + geom_smooth(method="gam",) + ylab("OM % of Slice") + xlab("Sediment Depth (cm)") + ggtitle("Organic Content by Sediment Depth ")+coord_flip()

OLOI_depth_lm=lm(OLOI ~ Factor*Sediment_Depth_cm + Factor, data=LOI_QAQC_By_Site_Slice)
summary(OLOI_depth_lm)

# Percent Inorganic Content
LOI_QAQC_By_Site_Slice%>%
  dplyr::mutate(Sediment_Depth_cm=as.factor(as.integer(Sediment_Depth_cm)))%>%
  # filter(Site!="STCHC")%>%
  dplyr::group_by(Factor,Site,Quadrat,Sediment_Depth_cm)%>%
  dplyr::summarize(mean=mean(ILOI,na.rm=TRUE))%>%
  mutate(Sediment_Depth_cm=as.integer(Sediment_Depth_cm))%>%
              ggplot(aes(y=(mean),x=-Sediment_Depth_cm,color=Factor,fill=Factor))+geom_point() + geom_smooth(method="gam",) + ylab("% Carbonte of Slice") + xlab("Sediment Depth (cm)") + ggtitle("Carbonate Content by Sediment Depth ")+coord_flip() 

ILOI_depth_lm=lm(ILOI ~ Factor*Sediment_Depth_cm + Factor, 
                 data=LOI_QAQC_By_Site_Slice)
                  # data=LOI_QAQC_By_Site_Slice[LOI_QAQC_By_Site_Slice$Site!="STCHC",])
summary(ILOI_depth_lm)


# Percent Organic Carbon
LOI_QAQC_By_Site_Slice%>%
  dplyr::mutate(Sediment_Depth_cm=as.factor(as.integer(Sediment_Depth_cm)))%>%
  dplyr::group_by(Factor,Site,Quadrat,Sediment_Depth_cm)%>%
  dplyr::summarize(mean=mean(Percent_Carbon,na.rm=TRUE))%>%
  mutate(Sediment_Depth_cm=as.integer(Sediment_Depth_cm))%>%
              ggplot(aes(y=(mean),x=-Sediment_Depth_cm,color=Factor,fill=Factor))+geom_point() + geom_smooth(method="gam",) + ylab("OC % of Slice") + xlab("Sediment Depth (cm)") + ggtitle("Percent Organic Carbon by Sediment Depth ")+coord_flip()

Percent_Carbon_depth_lm=lm(Percent_Carbon ~ Factor*Sediment_Depth_cm + Factor, data=LOI_QAQC_By_Site_Slice)
summary(Percent_Carbon_depth_lm)


# Organic Carbon Density
LOI_QAQC_By_Site_Slice%>%
  dplyr::mutate(Sediment_Depth_cm=as.factor(as.integer(Sediment_Depth_cm)))%>%
  dplyr::group_by(Factor,Site,Quadrat,Sediment_Depth_cm)%>%
  dplyr::summarize(mean=mean(Organic_Carbon_Density_g_per_ml,na.rm=TRUE))%>%
  mutate(Sediment_Depth_cm=as.integer(Sediment_Depth_cm))%>%
              ggplot(aes(y=(mean),x=-Sediment_Depth_cm,color=Factor,fill=Factor))+geom_point() + geom_smooth(method="gam",) + ylab("OC Density (g/cm3)") + xlab("Sediment Depth (cm)") + ggtitle("Organic Carbon Density by Sediment Depth ")+coord_flip()

OCD_depth_lm=lm(Organic_Carbon_Density_g_per_ml ~ Factor*Sediment_Depth_cm + Factor, data=LOI_QAQC_By_Site_Slice)
summary(OCD_depth_lm)


# Inorganic Carbon Density
LOI_QAQC_By_Site_Slice%>%
  dplyr::mutate(Sediment_Depth_cm=as.factor(as.integer(Sediment_Depth_cm)))%>%
  dplyr::group_by(Factor,Site,Quadrat,Sediment_Depth_cm)%>%
  dplyr::summarize(mean=mean(Inorganic_Carbon_Density_g_per_ml,na.rm=TRUE))%>%
  mutate(Sediment_Depth_cm=as.integer(Sediment_Depth_cm))%>%
              ggplot(aes(y=(mean),x=-Sediment_Depth_cm,color=Factor,fill=Factor))+geom_point() + geom_smooth(method="gam",) + ylab("IOC Density (g/cm3)") + xlab("Sediment Depth (cm)") + ggtitle("Inorganic Carbon Density by Sediment Depth ")+coord_flip()

ICD_depth_lm=lm(Inorganic_Carbon_Density_g_per_ml ~ Factor*Sediment_Depth_cm + Factor, data=LOI_QAQC_By_Site_Slice)
summary(OCD_depth_lm)


#  Total Carbon Density
LOI_QAQC_By_Site_Slice%>%
  dplyr::mutate(Sediment_Depth_cm=as.factor(as.integer(Sediment_Depth_cm)))%>%
  dplyr::group_by(Factor,Site,Quadrat,Sediment_Depth_cm)%>%
  dplyr::summarize(mean=mean(Total_Carbon_Density_g_per_ml,na.rm=TRUE))%>%
  mutate(Sediment_Depth_cm=as.integer(Sediment_Depth_cm))%>%
              ggplot(aes(y=(mean),x=-Sediment_Depth_cm,color=Factor,fill=Factor))+geom_point() + geom_smooth(method="gam",) + ylab("Total C Density (g/cm3)") + xlab("Sediment Depth (cm)") + ggtitle("Total Carbon Density by Sediment Depth ")+coord_flip()


#  Shell Density
LOI_QAQC_By_Site_Slice%>%
  dplyr::mutate(Sediment_Depth_cm=as.factor(as.integer(Sediment_Depth_cm)))%>%
  dplyr::group_by(Factor,Site,Quadrat,Sediment_Depth_cm)%>%
  dplyr::summarize(mean=mean(Shell_Density_g_per_ml,na.rm=TRUE))%>%
  mutate(Sediment_Depth_cm=as.integer(Sediment_Depth_cm))%>%
              ggplot(aes(y=(mean),x=-Sediment_Depth_cm,color=Factor,fill=Factor))+geom_point() + geom_smooth(method="gam",) + ylab("Shell Density (g/cm3)") + xlab("Sediment Depth (cm)") + ggtitle("Shell Density by Sediment Depth ")+coord_flip()



LOI_QAQC_By_Site=LOI_QAQC_By_Site_Slice%>%
  mutate(Organic_accum_per_cm=Organic_Content_Density_g_per_ml*Slice_Height_Corrected_cm,
  Inorganic_accum_per_cm=Inorganic_Content_Density_g_per_ml*Slice_Height_Corrected_cm,
  Shell_accum_per_cm=Shell_Density_g_per_ml*Slice_Height_Corrected_cm,
  Rhizome_accum_per_cm=Rhizome_Density_g_per_ml*Slice_Height_Corrected_cm,
  Organic_Carbon_accum_per_cm=Organic_Carbon_Density_g_per_ml*Slice_Height_Corrected_cm,
  Inorganic_Carbon_accum_per_cm=Inorganic_Carbon_Density_g_per_ml*Slice_Height_Corrected_cm)%>%
  dplyr::group_by(Site,Factor,Quadrat)%>% #AVERAGING WITHIN A QUADRAT
  dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),
                   ILOI=mean(ILOI,na.rm=TRUE),
                   Carbon=mean(Percent_Carbon,na.rm=TRUE),
                   Organic_accum_per_cm=mean(Organic_accum_per_cm,na.rm=TRUE),
                   Inorganic_accum_per_cm=mean(Inorganic_accum_per_cm,na.rm=TRUE),
                   Shell_accum_per_cm=mean(Shell_accum_per_cm,na.rm=TRUE),
                   Rhizome_accum_per_cm=mean(Rhizome_accum_per_cm,na.rm=TRUE),
                   Organic_Carbon_accum_per_cm=mean(Organic_Carbon_accum_per_cm,na.rm=TRUE),
                   Inorganic_Carbon_accum_per_cm=mean(Inorganic_Carbon_accum_per_cm,na.rm=TRUE))%>% # Converting the estiamtes to Value within a squre meter area up to 50cm sediment depth. (and 10 cm depth for rhizomes)
  dplyr::mutate(OM_g_per_sqm=Organic_accum_per_cm*(1/0.0001)*50,
         IOM_g_per_sqm=Inorganic_accum_per_cm*(1/0.0001)*50,
         Shell_g_per_sqm=Shell_accum_per_cm*(1/0.0001)*50,
         Rhizome_g_per_sqm=Rhizome_accum_per_cm*(1/0.0001)*10,
         OC_Stock_g_per_sqm=Organic_Carbon_accum_per_cm*(1/0.0001)*50,
         IOC_Stock_g_per_sqm=Inorganic_Carbon_accum_per_cm*(1/0.0001)*50,
         Total_C_Stock_g_per_sqm=IOC_Stock_g_per_sqm+OC_Stock_g_per_sqm)%>%
  dplyr::ungroup()%>%
  dplyr::group_by(Site,Factor)%>%
  dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),
                   ILOI=mean(ILOI,na.rm=TRUE),
                   Carbon=mean(Carbon,na.rm=TRUE),
                   Rhizome_Stock_g_per_sqm=mean(Rhizome_g_per_sqm,na.rm=TRUE),
                   Shell_Stock_g_per_sqm=mean(Shell_g_per_sqm,na.rm=TRUE),
                   Organic_Carbon_Stock_g_per_sqm=mean(OC_Stock_g_per_sqm,na.rm=TRUE),
                   Inorganic_Carbon_Stock_g_per_sqm=mean(IOC_Stock_g_per_sqm,na.rm=TRUE),
                   Total_Carbon_Stock_g_per_sqm=mean(Total_C_Stock_g_per_sqm,na.rm=TRUE))%>%
      ungroup()


seagrass_surveys_By_Site=seagrass_surveys%>%
  mutate(Total_Seagrass_Cover=(Seagrass_Spp/100)*(SAV_Cover/100)*100,
         Total_Algae_Cover=(Algal_Spp/100)*(SAV_Cover/100)*100)%>%
  group_by(Region,Site,Quadrat,Cover_Level)%>%
  dplyr::summarize(SAV_Cover=mean(SAV_Cover,na.rm=TRUE),Secchi_m=mean(Secchi_m,na.rm=TRUE),Depth_m=mean(Depth_m,na.rm=TRUE),Thalassia.testudinum=mean(Thalassia.testudinum,na.rm=TRUE),Syringodium.filiforme=mean(Syringodium.filiforme,na.rm=TRUE),Halodule.wrightii=mean(Halodule.wrightii,na.rm=TRUE),Algal_Spp=mean(Algal_Spp,na.rm=TRUE),Total_Seagrass_Cover=mean(Total_Seagrass_Cover,na.rm=TRUE),Total_Algae_Cover=mean(Total_Algae_Cover,na.rm=TRUE))%>%
  ungroup()%>%
  group_by(Region,Site,Cover_Level)%>%
  dplyr::summarize(SAV_Cover=mean(SAV_Cover,na.rm=TRUE),Secchi_m=mean(Secchi_m,na.rm=TRUE),Depth_m=mean(Depth_m,na.rm=TRUE),Thalassia.testudinum=mean(Thalassia.testudinum,na.rm=TRUE),Syringodium.filiforme=mean(Syringodium.filiforme,na.rm=TRUE),Halodule.wrightii=mean(Halodule.wrightii,na.rm=TRUE),Algal_Spp=mean(Algal_Spp),Total_Seagrass_Cover=mean(Total_Seagrass_Cover,na.rm=TRUE),Total_Algae_Cover=mean(Total_Algae_Cover,na.rm=TRUE))%>%
  ungroup()

ggplot(seagrass_surveys_By_Site,aes(x=Total_Seagrass_Cover))+geom_histogram()+xlab("Total Seagrass Cover (%)") +ylab("Number of Sites")


Environmental_Factors_Sites=seagrass_surveys%>%
  dplyr::select(Site,Latitude,Longitude,Salinity.Min,Nitrate.Mean,Light.bottom.Min,Par.Mean,Dist_To_River,Dist_To_Shore)%>%
  group_by(Site)%>%
  dplyr::summarize(Latitude=mean(Latitude,na.rm=TRUE),Longitude=mean(Longitude,na.rm=TRUE),Salinity.Min=mean(Salinity.Min,na.rm=TRUE),Nitrate.Mean=mean(Nitrate.Mean,na.rm=TRUE),Light.bottom.Min=mean(Light.bottom.Min,na.rm=TRUE),Par.Mean=mean(Par.Mean,na.rm=TRUE),Dist_To_River=mean(Dist_To_River,na.rm=TRUE),Dist_To_Shore=mean(Dist_To_Shore,na.rm=TRUE))%>%
  ungroup()


seagrass_surveys_By_Site=join(seagrass_surveys_By_Site,Environmental_Factors_Sites,by="Site")


seagrass_survey_AND_Clippings_By_Site=join(seagrass_surveys_By_Site,seagrass_clippings_Site[c(1,16,15,12,11,6)],by="Site")

seagrass_survey_AND_Clippings_By_Site=seagrass_survey_AND_Clippings_By_Site%>%
  mutate(Seagrass_Biomass_g_per_sqm=Seagrass_Biomass_gDW/0.0625,
         Macro_Algae_Biomass_g_per_sqm=Macro_Algae_Biomass_gDW/0.0625,
         Thalassia_testudinum_g_per_sqm=Thalassia_testudinum_gDW/0.0625,
         Syringodium_filiforme_g_per_sqm=Syringodium_filiforme_gDW/0.0625,
         Halodule_wrightii_g_per_sqm=Halodule_wrightii_gDW/0.0625)%>%
  dplyr::select(1:20,26:30)

write.csv(seagrass_survey_AND_Clippings_By_Site,"data_output/Seagrass_Clippings_QAQC_Site_03_18_2021.csv")


Grainsize_QAQC_By_Site_Quad=Grainsize_QAQC%>%
  group_by(Site,Quadrat)%>%
  dplyr::summarize(Percent_Shell=mean(Percent_Shell,na.rm=TRUE),Percent_Gravel=mean(Percent_Gravel,na.rm=TRUE),Percent_Coarse=mean(Percent_Coarse,na.rm=TRUE),Percent_Medium=mean(Percent_Medium,na.rm=TRUE),Percent_Fine=mean(Percent_Fine,na.rm=TRUE),Percent_Silt=mean(Percent_Silt,na.rm=TRUE))%>%
  ungroup()


Grainsize_QAQC_By_Site=Grainsize_QAQC_By_Site_Quad%>%
  group_by(Site)%>%
  dplyr::summarize(Percent_Shell=mean(Percent_Shell,na.rm=TRUE),Percent_Gravel=mean(Percent_Gravel,na.rm=TRUE),Percent_Coarse=mean(Percent_Coarse,na.rm=TRUE),Percent_Medium=mean(Percent_Medium,na.rm=TRUE),Percent_Fine=mean(Percent_Fine,na.rm=TRUE),Percent_Silt=mean(Percent_Silt,na.rm=TRUE))%>%
  ungroup()
names(Grainsize_QAQC_By_Site)
```





#MAKING THE BLUE CARBON DATASET 
```{r}
BlueCarbon_QAQC=plyr::join(seagrass_survey_AND_Clippings_By_Site,LOI_QAQC_By_Site,by=c("Site"),match="all",type="inner")


BlueCarbon_QAQC=plyr::join(BlueCarbon_QAQC,Grainsize_QAQC_By_Site,by=c("Site"),match="all",type="inner")


New_Dist_To_River<-read.csv("arc_output/New_Dist_To_River_Calculation.csv")

BlueCarbon_QAQC=join(BlueCarbon_QAQC,New_Dist_To_River[c(2,5)],by=c("Site"),match="all",type="inner")

BlueCarbon_QAQC$Dist_To_River<-BlueCarbon_QAQC$Dist_To_River_km

names(BlueCarbon_QAQC)

BlueCarbon_QAQC=BlueCarbon_QAQC[c(1:40)]%>%
  mutate(Cover_Level=ifelse(Total_Seagrass_Cover>=50,"high",ifelse(Total_Seagrass_Cover<50 & Total_Seagrass_Cover>5,"low",ifelse(Total_Seagrass_Cover<5,"none", Total_Seagrass_Cover))))%>%
  mutate(TH_PA=ifelse(Thalassia.testudinum>0,1,0),SY_PA=ifelse(Syringodium.filiforme>0,1,0),HA_PA=ifelse(Halodule.wrightii>0,1,0),TH_PA=as.factor(TH_PA),SY_PA=as.factor(SY_PA),HA_PA=as.factor(HA_PA))
# %>%
  # mutate(Factor=ifelse(Cover_Level=="none","Control","Seagrass"))

summary(BlueCarbon_QAQC)

#%Total Seagrass Cover
BlueCarbon_QAQC%>%
  dplyr::group_by(Factor)%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Factor,y=Total_Seagrass_Cover,fill=Factor))+geom_boxplot()+xlab("Survey Strata")+ylab("Total Seagrass Cover")+ggtitle("A")+facet_wrap(~Region)

#Seagrass species composition
BlueCarbon_QAQC%>%
  dplyr::select(Region,Factor,Thalassia.testudinum,Syringodium.filiforme,Halodule.wrightii,Algal_Spp)%>%
  group_by(Region,Factor)%>%
  gather(key="Species",value="Cover",3:6)%>%
  mutate(Species=factor(Species,levels=c("Algal_Spp","Halodule.wrightii","Syringodium.filiforme","Thalassia.testudinum"),labels = c("Macro Algae","Shoal Grass","Manatee Grass","Turtle Grass")))%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Region,y=Cover,fill=Species))+geom_boxplot()+xlab("Region")+ylab(" Species Composition \n(fraction of total cover)")+ggtitle("B")

#%Total Seagrass Biomass 
BlueCarbon_QAQC%>%
  dplyr::group_by(Factor)%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Factor,y=Seagrass_Biomass_g_per_sqm,fill=Factor))+geom_boxplot()+xlab("Survey Strata")+ylab("Total Seagrass Biomass (g/sqm)")+ggtitle("C")+facet_wrap(~Region)


#Species Biomass
BlueCarbon_QAQC%>%
  dplyr::select(Region,Factor,Thalassia_testudinum_g_per_sqm,Syringodium_filiforme_g_per_sqm,Halodule_wrightii_g_per_sqm,Macro_Algae_Biomass_g_per_sqm)%>%
  group_by(Region,Factor)%>%
  gather(key="Species",value="Biomass",3:6)%>%
    mutate(Species=factor(Species,levels=c("Macro_Algae_Biomass_g_per_sqm","Halodule_wrightii_g_per_sqm","Syringodium_filiforme_g_per_sqm","Thalassia_testudinum_g_per_sqm"),labels = c("Macro Algae","Shoal Grass","Manatee Grass","Turtle Grass")))%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Region,y=Biomass,fill=Species))+geom_boxplot()+xlab("Region")+ylab("Seagrass Biomass Species (g/sqm)")+ggtitle("D")


# Rhizome g/sqm
BlueCarbon_QAQC%>%
  dplyr::group_by(Factor)%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Factor,y=Rhizome_Stock_g_per_sqm,fill=Factor))+geom_boxplot()+xlab("Survey Strata")+ylab("Rhizome Biomass (g/sqm)")+ggtitle("A")+facet_wrap(~Region)

rhizome_site_lm=lm(Rhizome_Stock_g_per_sqm~Factor +Region,data=BlueCarbon_QAQC)


# Shell g/sqm
BlueCarbon_QAQC%>%
  dplyr::group_by(Factor)%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Factor,y=Shell_Stock_g_per_sqm,fill=Factor))+geom_boxplot()+xlab("Survey Strata")+ylab("Shell Stock (g/sqm)")+ggtitle("B")+facet_wrap(~Region)

shell_site_lm=lm(Shell_Stock_g_per_sqm~Factor +Region,data=BlueCarbon_QAQC)


# Carbon Stock
BlueCarbon_QAQC%>%
  dplyr::group_by(Factor)%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Factor,y=Organic_Carbon_Stock_g_per_sqm,fill=Factor))+geom_boxplot()+xlab("Survey Strata")+ylab(" Organic Carbon Stock (g/sqm)")+ggtitle("C")+ facet_wrap(~Region)

organic_site_lm=lm(Organic_Carbon_Stock_g_per_sqm~Factor +Region,data=BlueCarbon_QAQC)


# Inorganic Carbon Stock
BlueCarbon_QAQC%>%
  dplyr::group_by(Factor)%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Factor,y=Inorganic_Carbon_Stock_g_per_sqm,fill=Factor))+geom_boxplot()+xlab("Survey Strata")+ylab("Inorganic Carbon Stock (gC/sqm)")+ggtitle("D")+facet_wrap(~Region)

carbonate_site_lm=lm(Inorganic_Carbon_Stock_g_per_sqm~Factor +Region,data=BlueCarbon_QAQC)

# Total Carbon Stock
BlueCarbon_QAQC%>%
  dplyr::group_by(Factor)%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Factor,y=Total_Carbon_Stock_g_per_sqm))+geom_boxplot()+xlab("Survey Strata")+ylab("Average Total Carbon Stock (gC/sqm)")+ggtitle("F")+facet_wrap(~Region)

totC_site_lm=lm(Total_Carbon_Stock_g_per_sqm~Factor +Region,data=BlueCarbon_QAQC)



#Sediments by region and factor
BlueCarbon_QAQC%>%
  dplyr::select(Region,Factor,Percent_Gravel,Percent_Coarse,Percent_Medium,Percent_Fine,Percent_Silt)%>%
  group_by(Region,Factor)%>%
  gather(key="Grainsizes",value="Percent",3:7)%>%
    mutate(Grainsizes=factor(Grainsizes,levels=c("Percent_Gravel","Percent_Coarse","Percent_Medium","Percent_Fine","Percent_Silt")))%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Factor,y=Percent,fill=Region))+geom_boxplot()+xlab("Region")+ylab("Grainsize Composition \n(% of sample weight)")+ggtitle("A") +facet_wrap(~Grainsizes,ncol=1,scales = "free_y")

silt_site_lm=lm(Percent_Silt~Factor + Dist_To_River,data=BlueCarbon_QAQC)
summary(silt_site_lm)

fine_site_lm=lm(Percent_Fine~Factor +Dist_To_River,data=BlueCarbon_QAQC)
summary(fine_site_lm)

medium_site_lm=lm(Percent_Medium~Factor +Dist_To_River,data=BlueCarbon_QAQC)
summary(medium_site_lm)

coarse_site_lm=lm(Percent_Coarse~Factor +Dist_To_River ,data=BlueCarbon_QAQC)
summary(coarse_site_lm)

gravel_site_lm=lm(Percent_Gravel~Factor +Dist_To_River,data=BlueCarbon_QAQC)
summary(gravel_site_lm)

#sediment byfactor
BlueCarbon_QAQC%>%
  dplyr::select(Region,Factor,Percent_Gravel,Percent_Coarse,Percent_Medium,Percent_Fine,Percent_Silt)%>%
  group_by(Region,Factor)%>%
  gather(key="Grainsizes",value="Percent",3:7)%>%
    mutate(Grainsizes=factor(Grainsizes,levels=c("Percent_Gravel","Percent_Coarse","Percent_Medium","Percent_Fine","Percent_Silt")))%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Factor,y=Percent,fill=Grainsizes))+geom_boxplot()+xlab("Region")+ylab("Grainsize Composition \n(% of sample weight)")+ggtitle("A")# +facet_wrap(~Grainsizes,ncol=1,scales = "free_y")

#Environmental Factors
BlueCarbon_QAQC%>%
  dplyr::select(Region,Factor,Latitude,Depth_m,Dist_To_Shore,Dist_To_River,Light.bottom.Min,Salinity.Min,Nitrate.Mean)%>%
  group_by(Region,Factor)%>%
  gather(key="Variable",value="Value",3:9)%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=Region,y=Value))+geom_boxplot()+xlab("Region")+ylab("")+ggtitle("A")+ facet_wrap(~Variable,scales = "free_y")

#Testing univariate relationships 
# Seagrass Cover 
ggplot(BlueCarbon_QAQC,aes(x=(SAV_Cover),y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=(Total_Seagrass_Cover),y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Total_Algae_Cover,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point() +geom_smooth(method="gam")
# 

ggplot(BlueCarbon_QAQC,aes(x=Thalassia_testudinum_g_per_sqm,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")


ggplot(BlueCarbon_QAQC,aes(x=Halodule_wrightii_g_per_sqm,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")


BlueCarbon_QAQC%>%
  mutate(TH_PA=as.factor(TH_PA))%>%
  dplyr::filter(Factor=="Seagrass")%>%
  ggplot(aes(y=Organic_Carbon_Stock_g_per_sqm,x=TH_PA,fill=TH_PA)) + geom_boxplot()


ggplot(BlueCarbon_QAQC,aes(x=Syringodium_filiforme_g_per_sqm,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

BlueCarbon_QAQC%>%
  mutate(SY_PA=as.factor(SY_PA))%>%
  dplyr::filter(Factor=="Seagrass")%>%
  ggplot(aes(y=OLOI,x=SY_PA,fill=SY_PA)) + geom_boxplot()


ggplot(BlueCarbon_QAQC,aes(x=Halodule_wrightii_g_per_sqm,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

BlueCarbon_QAQC%>%
  mutate(HA_PA=as.factor(HA_PA))%>%
  dplyr::filter(Factor=="Seagrass")%>%
  ggplot(aes(y=OLOI,x=HA_PA,fill=HA_PA)) + geom_boxplot()


ggplot(BlueCarbon_QAQC,aes(x=Secchi_m,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Depth_m,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Percent_Shell,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Percent_Gravel,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Percent_Coarse,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Percent_Medium,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Percent_Fine,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Percent_Silt,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Salinity.Min,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Nitrate.Mean,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Light.bottom.Min,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Par.Mean,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Dist_To_River,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Dist_To_Shore,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Latitude,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")

ggplot(BlueCarbon_QAQC,aes(x=Longitude,y=Organic_Carbon_Stock_g_per_sqm))+ geom_point()+geom_smooth(method="gam")


BlueCarbon_QAQC%>%
   dplyr::group_by(Region)%>%
   dplyr::summarize(Nitrates=mean(Nitrate.Mean,na.rm=TRUE), Depth=mean(Depth_m,na.rm=TRUE), Secchi_m=mean(Secchi_m,na.rm=TRUE),Dist_To_Shore=mean(Dist_To_Shore,na.rm=TRUE),Dist_To_River=mean(Dist_To_River,na.rm=TRUE),Light=mean(Light.bottom.Min,na.rm=TRUE))
 
library(sf)  
FWCC_Seagrass_Maps=shapefile("C:/Users/jennm/Dropbox/GITHUB/Disseratation/Large_Project_DataSets/Raw_Biological_Datasets/FWC_Seagrass_Composite_Maps_4_22_2020.shp")
# names(FWCC_Seagrass_Maps)<-c("FWCC_Seagrass_Maps")


Temperature.Mean=raster("C:/Users/jennm/Dropbox/GITHUB/Disseratation/Large_Project_DataSets/BioOracle/data_output/Present.Benthic.Mean.Depth.Temperature.Mean.tif")
names(Temperature.Mean)<-c("Temperature.Mean")

Primary.productivity.Max=raster("C:/Users/jennm/Dropbox/GITHUB/Disseratation/Large_Project_DataSets/BioOracle/data_output/Present.Benthic.Mean.Depth.Primary.productivity.Max.tif")
names(Primary.productivity.Max)<-c("Primary.productivity.Max")
# 
coordinates(BlueCarbon_QAQC)<- ~Longitude + Latitude
proj4string(BlueCarbon_QAQC) <- CRS("+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")
## 
Mapped_points=over(BlueCarbon_QAQC, FWCC_Seagrass_Maps[4]) 
Temperature.Mean.pts=extract(x=Temperature.Mean,y=BlueCarbon_QAQC)
PPM.pts=extract(x=Primary.productivity.Max,y=BlueCarbon_QAQC)

# 
FWCC_Seagrass_Extent=as.vector(Mapped_points)
Temperature.Mean.pts=as.data.frame(Temperature.Mean.pts)
PPM.pts=as.data.frame(PPM.pts)

BlueCarbon_QAQC=as.data.frame(cbind(BlueCarbon_QAQC,FWCC_Seagrass_Extent,Temperature.Mean.pts,PPM.pts))
names(BlueCarbon_QAQC)[42:44]<-c("FWCC_Seagrass_Extent","Temperature.Mean","Primary.productivity.Max")
# 
summary(BlueCarbon_QAQC)
# names(BlueCarbon_QAQC)
# 
summary(as.factor(BlueCarbon_QAQC$FWCC_Seagrass_Extent))
# 
# Rhizome g/sqm
BlueCarbon_QAQC%>%
  group_by(FWCC_Seagrass_Extent)%>%
  # dplyr::summarize(OLOI=mean(OLOI,na.rm=TRUE),ILOI=mean(ILOI,na.rm=TRUE))%>%
  ggplot(aes(x=FWCC_Seagrass_Extent,y=Rhizome_Stock_g_per_sqm))+geom_boxplot()+xlab("Survey Strata")+ylab("Average Rhizome Carbon Stock (g/sqm)")


write.csv(BlueCarbon_QAQC,file="data_output/BlueCarbon_QAQC.csv")

save.image(file="C:/Users/jennm/Dropbox/GITHUB/Disseratation/Saved_RData/Blue_Carbon_Datasets.RData")

```


